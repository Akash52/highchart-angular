<div class="draggable-elements-container">
  <!-- Highcharts Chart -->
  <div class="chart-wrapper">
    <highcharts-chart
      [Highcharts]="Highcharts"
      [options]="chartOptions"
      [callbackFunction]="chartCallback"
      style="width: 100%; height: 400px; display: block;"
    ></highcharts-chart>
  </div>

  <!-- Add New Element Button -->
  <div class="toolbar">
    <button class="btn btn-primary" (click)="onCreate()">
      <span class="icon">+</span> Add New Element
    </button>
  </div>

  <!-- Floating CRUD Menu -->
  <div 
    class="crud-menu" 
    *ngIf="showMenu"
    [style.left.px]="menuX"
    [style.top.px]="menuY"
  >
    <div class="menu-header">
      <strong>{{ selectedElement?.name }}</strong>
      <button class="close-btn" (click)="closeMenu()">√ó</button>
    </div>
    <div class="menu-items">
      <button class="menu-item create" (click)="onCreate()">
        <span class="icon">+</span> Create New
      </button>
      <button class="menu-item read" (click)="onRead()">
        <span class="icon">üëÅ</span> View Details
      </button>
      <button class="menu-item update" (click)="onUpdate()">
        <span class="icon">‚úé</span> Edit
      </button>
      <button class="menu-item delete" (click)="onDelete()">
        <span class="icon">üóë</span> Delete
      </button>
    </div>
  </div>

  <!-- Backdrop for menu -->
  <div class="backdrop" *ngIf="showMenu" (click)="closeMenu()"></div>

  <!-- CRUD Form Modal -->
  <div class="modal-overlay" *ngIf="showForm">
    <div class="modal">
      <div class="modal-header">
        <h2>
          {{ formMode === 'create' ? 'Create New Element' : 
             formMode === 'update' ? 'Update Element' : 
             'Element Details' }}
        </h2>
        <button class="close-btn" (click)="closeForm()">√ó</button>
      </div>
      
      <div class="modal-body">
        <form (ngSubmit)="submitForm()" #elementForm="ngForm">
          <div class="form-group">
            <label for="name">Name:</label>
            <input 
              type="text" 
              id="name"
              [(ngModel)]="formData.name" 
              name="name"
              [disabled]="formMode === 'view'"
              required
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="description">Description:</label>
            <textarea 
              id="description"
              [(ngModel)]="formData.description" 
              name="description"
              [disabled]="formMode === 'view'"
              rows="3"
              class="form-control"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="color">Color:</label>
            <div class="color-input-wrapper">
              <input 
                type="color" 
                id="color"
                [(ngModel)]="formData.color" 
                name="color"
                [disabled]="formMode === 'view'"
                class="form-control-color"
              />
              <input 
                type="text" 
                [(ngModel)]="formData.color" 
                name="colorText"
                [disabled]="formMode === 'view'"
                class="form-control color-text"
                placeholder="#3498db"
              />
            </div>
          </div>

          <div class="modal-footer" *ngIf="formMode !== 'view'">
            <button type="button" class="btn btn-secondary" (click)="closeForm()">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="!elementForm.form.valid">
              {{ formMode === 'create' ? 'Create' : 'Update' }}
            </button>
          </div>
          <div class="modal-footer" *ngIf="formMode === 'view'">
            <button type="button" class="btn btn-primary" (click)="closeForm()">
              Close
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
